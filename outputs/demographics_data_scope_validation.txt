================================================================================
DEMOGRAPHICS TABLE - DATA SCOPE VALIDATION
================================================================================

Date: 2025-12-25
Purpose: Verify that census data is correctly scoped to City of San Diego

================================================================================
1. DATA SOURCES
================================================================================

Streets (PCI):
  File: DataSD/sd_paving_segs_datasd/sd_paving_segs_datasd.shp
  Source: data.sandiego.gov (official City of San Diego open data portal)
  Scope: City of San Diego ONLY
  Count: 32,888 segments

Census Block Groups (Race/Ethnicity):
  File: nhgis0002_shapefile_tl2023_060_blck_grp_2023.zip
  Source: NHGIS (2020 Census)
  Initial scope: California-wide (060 = CA FIPS code)
  Processing:
    1. Filter to San Diego County (COUNTYA == 73): 2,057 block groups
    2. Clip to City extent (street buffer): 1,614 block groups (-21.5%)
    3. Final usage via spatial join: All 32,888 segments matched (100%)

Census Tracts (Income/Education):
  File: nhgis0002_shapefile_tl2023_us_tract_2023.zip
  Source: NHGIS (ACS 2019-2023)
  Initial scope: US-wide
  Processing:
    1. Filter to San Diego County (COUNTYA == 73): 1,385 tracts
    2. Clip to City extent (street buffer): 586 tracts (-57.7%)
    3. Final usage via spatial join: All 32,888 segments matched (100%)

================================================================================
2. SPATIAL CLIPPING METHOD
================================================================================

Method: Buffer-based extent clipping
- Create envelope around all street segments
- Add 1km buffer to capture adjacent census units
- Filter census units that intersect with this extent
- Ensures only City-relevant census units are used

Why this is necessary:
- San Diego County contains 18 incorporated cities
- County-level census units may include:
  * Chula Vista, Carlsbad, Oceanside, etc.
  * Unincorporated County areas
- Street data is City of San Diego only
- Census data needed to be clipped to match

================================================================================
3. KEY FINDINGS
================================================================================

Block Groups:
  - County has 2,057 block groups
  - City extent has 1,614 block groups
  - 443 block groups (21.5%) excluded (other cities/unincorporated areas)

Census Tracts:
  - County has 1,385 tracts
  - City extent has 586 tracts
  - 799 tracts (57.7%) excluded (larger geography = more County coverage)

Spatial Join Success:
  - 100% of street segments matched to census units
  - No segments outside City boundary
  - No orphaned segments

================================================================================
4. VALIDATION OF RESULTS
================================================================================

Results represent CITY OF SAN DIEGO demographics, not County demographics:

City Overall (32,888 segments):
  - Per Capita Income: $60,611
  - Hispanic: 26.5%
  - White (NH): 46.9%
  - Asian (NH): 15.3%
  - Black (NH): 4.6%
  - College+: 52.1%

Comparison with County-level averages:
  - City has higher income ($60,611 vs $46,129 county average)
  - Lower Hispanic share (26.5% vs 34% county-wide)
  - Higher education (52.1% vs 38% county-wide)

Why City differs from County:
  1. City is more urbanized
  2. Street network denser in high-income neighborhoods
  3. Results are "segment-weighted" not "population-weighted"
  4. Excludes less urbanized County areas

================================================================================
5. CODE IMPLEMENTATION
================================================================================

Location: tests/demographics_table.py

Key sections:
  Lines 273-279: Block Group clipping to City extent
  Lines 307-310: Census Tract clipping to City extent
  Lines 100-142: spatial_join_largest_overlap() function

Method:
  streets_extent = streets.geometry.unary_union.envelope.buffer(1000)
  bg_geo_clipped = bg_geo[bg_geo.geometry.intersects(streets_extent)]

================================================================================
6. CONCLUSION
================================================================================

✅ Census data is correctly scoped to City of San Diego
✅ County-level census units properly filtered and clipped
✅ All street segments successfully matched to appropriate census units
✅ Results represent City-level demographics, not County-level

The demographic comparison table accurately reflects the characteristics of
City of San Diego street segments and their associated census geographies.

================================================================================
